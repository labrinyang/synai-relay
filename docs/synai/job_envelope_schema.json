{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "ATP Code Fix Job Envelope",
    "type": "object",
    "properties": {
        "protocol_version": {
            "type": "string",
            "const": "0.1.0"
        },
        "task_id": {
            "type": "string"
        },
        "task_type": {
            "type": "string",
            "const": "code_fix"
        },
        "payload": {
            "type": "object",
            "properties": {
                "problem_description": {
                    "type": "string"
                },
                "files": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    },
                    "description": "Map of relative file paths to base64 encoded content"
                },
                "entrypoint": {
                    "type": "string",
                    "description": "Command to run tests"
                },
                "verification_regex": {
                    "type": "string",
                    "description": "Regex to match against test output for success"
                }
            },
            "required": [
                "problem_description",
                "files",
                "entrypoint",
                "verification_regex"
            ]
        },
        "terms": {
            "type": "object",
            "properties": {
                "price": {
                    "type": "string"
                },
                "currency": {
                    "type": "string",
                    "default": "ETH"
                },
                "timeout_blocks": {
                    "type": "integer"
                }
            },
            "required": [
                "price"
            ]
        }
    },
    "required": [
        "protocol_version",
        "task_type",
        "payload",
        "terms"
    ]
}